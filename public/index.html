<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <link rel="icon" type="image/gif" href="%PUBLIC_URL%/2.gif" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#000000" />
  <meta name="description" content="主页网站简介 WangYi!" />
  <meta property="og:site_name" content="WangYi Profile Page">
  <meta property="og:image" content="https://media.discordapp.net/attachments/1392004981829140492/1407226678664757328/image.png?ex=68a55579&is=68a403f9&hm=61abfc5512d252ed054f899cc4a08e9482d618a03e857eb7e77d81b926a8dc6b&=&format=webp&quality=lossless&width=704&height=545">
  <meta property="og:title" content="WangYi Profile Page">
  <meta property="og:description" content="How Can I Get You If I'm Normal?on" />
  <meta property="og:url" content="https://wang-yi-lumi21.vercel.app/">
  <title>WangYi</title>
</head>
<body>
  <noscript>You need to enable JavaScript to run this app.</noscript>
  <div id="root"></div>

  <!-- Audio element -->
  <audio id="background-music" preload="metadata">
    Trình duyệt của bạn không hỗ trợ thẻ audio.
  </audio>

  <script>
    const audio = document.getElementById('background-music');
    audio.volume = 0.3; // âm lượng mặc định
    
    // Danh sách nhạc
    const musicTracks = [
      "music/FRAGRANCE-SYENSAN-REMIX-NHẠC-VIRAL-TIKTOK-2025.mp3",
      "music/Vietsub ｜ Normal No More - TYSM ｜ Nhạc Hot TikTok ｜ Lyrics Video.mp3"
    ];
    
    let currentTrackIndex = 0;
    let audioStarted = true;

    // Hàm chọn bài hát ngẫu nhiên
    const selectRandomTrack = () => {
      const randomIndex = Math.floor(Math.random() * musicTracks.length);
      currentTrackIndex = randomIndex;
      audio.src = musicTracks[currentTrackIndex];
      console.log('Selected track:', musicTracks[currentTrackIndex]);
    };

    // Hàm phát bài tiếp theo (ngẫu nhiên)
    const playNextTrack = () => {
      selectRandomTrack();
      if (audioStarted) {
        audio.play().catch(error => console.log('Play next track failed:', error));
      }
    };

    const tryPlayAudio = () => {
      if (audioStarted) return;
      selectRandomTrack(); // Chọn bài đầu tiên ngẫu nhiên
      audio.play().then(() => {
        audioStarted = true;
        console.log('Audio started successfully');
      }).catch(() => {
        console.log('Autoplay blocked, waiting for user interaction');
      });
    };

    const handleUserInteraction = () => {
      if (audioStarted) return;
      if (!audio.src) selectRandomTrack(); // Đảm bảo có bài hát được chọn
      audio.play().then(() => {
        audioStarted = true;
        console.log('Audio started after user interaction');
        removeInteractionListeners();
      }).catch(error => console.log('Play failed:', error));
    };

    const addInteractionListeners = () => {
      ['click','touchstart','touchend','keydown','scroll'].forEach(evt => {
        document.addEventListener(evt, handleUserInteraction, { passive: true });
      });
    };

    const removeInteractionListeners = () => {
      ['click','touchstart','touchend','keydown','scroll'].forEach(evt => {
        document.removeEventListener(evt, handleUserInteraction);
      });
    };

    const initAudio = () => {
      tryPlayAudio(); // cố gắng autoplay trên desktop
      
      setTimeout(() => {
        if (!audioStarted) addInteractionListeners(); // nếu bị chặn, yêu cầu tương tác
      }, 100);
    };

    // Khi một bài hát kết thúc, phát bài tiếp theo ngẫu nhiên
    audio.addEventListener('ended', playNextTrack);

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initAudio);
    } else {
      initAudio();
    }

    document.addEventListener('visibilitychange', () => {
      if (document.hidden && !audio.paused) {
        audio.pause();
      } else if (!document.hidden && audioStarted) {
        audio.play().catch(e => console.log('Resume failed:', e));
      }
    });

    // Event listeners cho debug
    audio.addEventListener('loadstart', () => console.log('Audio loading...'));
    audio.addEventListener('canplay', () => console.log('Audio ready to play'));
    audio.addEventListener('playing', () => console.log('Audio is playing'));
    audio.addEventListener('error', (e) => console.log('Audio error:', e));
  </script>
</body>
</html>
