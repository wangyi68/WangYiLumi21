<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <link rel="icon" type="image/gif" href="%PUBLIC_URL%/2.gif" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#000000" />
  <meta name="description" content="主页网站简介 WangYi!" />
  <meta property="og:site_name" content="WangYi Profile Page">
  <meta property="og:image" content="https://media.discordapp.net/attachments/1392004981829140492/1407226678664757328/image.png">
  <meta property="og:title" content="WangYi Profile Page">
  <meta property="og:description" content="How Can I Get You If I'm Normal?on" />
  <meta property="og:url" content="https://wang-yi-lumi21.vercel.app/">
  <title>WangYi</title>
</head>
<body>
  <noscript>You need to enable JavaScript to run this app.</noscript>
  <div id="root"></div>

  <!-- Audio element -->
  <audio id="background-music" preload="metadata"></audio>

  <script>
    const audio = document.getElementById('background-music');
    audio.volume = 0.3;

    // Danh sách nhạc trong thư mục ./music
    const playlist = [
      "FRAGRANCE-SYENSAN-REMIX-NHẠC-VIRAL-TIKTOK-2025.mp3",
      "song2.mp3"
    ].map(file => `music/${file}`);

    let audioStarted = false;

    // chọn random nhạc
    const playRandomSong = () => {
      const randomIndex = Math.floor(Math.random() * playlist.length);
      audio.src = playlist[randomIndex];
      audio.play().then(() => {
        console.log(`Playing: ${playlist[randomIndex]}`);
      }).catch(err => console.log("Play failed:", err));
    };

    const tryPlayAudio = () => {
      if (audioStarted) return;
      playRandomSong();
      audioStarted = true;
    };

    const handleUserInteraction = () => {
      if (audioStarted) return;
      playRandomSong();
      audioStarted = true;
      removeInteractionListeners();
      console.log("Audio started after user interaction");
    };

    const addInteractionListeners = () => {
      ['click','touchstart','touchend','keydown','scroll'].forEach(evt => {
        document.addEventListener(evt, handleUserInteraction, { passive: true });
      });
    };

    const removeInteractionListeners = () => {
      ['click','touchstart','touchend','keydown','scroll'].forEach(evt => {
        document.removeEventListener(evt, handleUserInteraction);
      });
    };

    const initAudio = () => {
      tryPlayAudio();
      setTimeout(() => {
        if (!audioStarted) addInteractionListeners();
      }, 100);
    };

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initAudio);
    } else {
      initAudio();
    }

    // Pause khi ẩn tab
    document.addEventListener('visibilitychange', () => {
      if (document.hidden && !audio.paused) audio.pause();
      else if (!document.hidden && audioStarted) {
        audio.play().catch(e => console.log('Resume failed:', e));
      }
    });

    // Khi nhạc hết bài -> random bài mới
    audio.addEventListener('ended', playRandomSong);

    // Debug log
    audio.addEventListener('loadstart', () => console.log('Audio loading...'));
    audio.addEventListener('canplay', () => console.log('Audio ready to play'));
    audio.addEventListener('playing', () => console.log('Audio is playing'));
    audio.addEventListener('error', (e) => console.log('Audio error:', e));
  </script>
</body>
</html>
